  1  A                         **********************************
  2  A                         *PROGRAMA DE EJEMPLO
  3  A                         **********************************
  4  A        1026            PACTL  EQU   $1026
  5  A        1027            PACNT  EQU   $1027
  6  A        1030            ADCTL  EQU   $1030
  7  A        1031            ADR1   EQU   $1031
  8  A        1032            ADR2   EQU   $1032
  9  A        1033            ADR3   EQU   $1033
 10  A        1034            ADR4   EQU   $1034
 11  A        1039            OPTION EQU   $1039
 12  A                         
 13  A        1000            PORTA  EQU   $1000
 14  A        1008            PORTD  EQU   $1008
 15  A        100A            PORTE  EQU   $100A
 16  A        1002            PORTG  EQU   $1002
 17  A                         
 18  A        1001            DDRA   EQU   $1001
 19  A        1009            DDRD   EQU   $1009
 20  A        1003            DDRG   EQU   $1003
 21  A                         
 22  A        1024            TMSK2  EQU   $1024
 23  A        1025            TFLG2  EQU   $1025
 24  A                         
 25  A        102F            SCDR   EQU   $102F
 26  A        102D            SCCR2  EQU   $102D
 27  A        102E            SCSR   EQU   $102E
 28  A        102C            SCCR1  EQU   $102C
 29  A        102B            BAUD   EQU   $102B
 30  A        103C            HPRIO  EQU   $103C
 31  A        1028            SPCR   EQU   $1028
 32  A        105D            CSCTL  EQU   $105D
 33  A        1038            OPT2   EQU   $1038
 34  A                         
 35  A                         * VARIABLES *********************
 36  A                         
 37  A        000C            ORDEN  EQU   $000C
 38  A        000D            SEG    EQU   $000D
 39  A        000E            U1     EQU   $000E
 40  A        000F            U2     EQU   $000F
 41  A        0010            U3     EQU   $0010
 42  A        0011            U4     EQU   $0011
 43  A        0012            U5     EQU   $0012
 44  A        0013            V1     EQU   $0013
 45  A        0014            V2     EQU   $0014
 46  A        0015            BAS_H  EQU   $0015
 47  A        0016            BAS_L  EQU   $0016
 48  A        0017            V5     EQU   $0017
 49  A        0018            TEMPO  EQU   $0018
 50  A        0019            ALTO   EQU   $0019
 51  A        001A            BAJO   EQU   $001A
 52  A        001B            BASE_H EQU   $001B
 53  A        001C            BASE_L EQU   $001C
 54  A        001D            V3     EQU   $001D
 55  A        001E            V4     EQU   $001E
 56  A                         
 57  A                         **********************************
 58  A                         *CONFIGURA REGISTROS
 59  A                         **********************************
 60  A  8000                         ORG   $8000   * DIR DE INICIO
 61  A  8000  8E00FF                 LDS   #$00FF  * APUNTADOR DE STAK
 62  A                         
 63  A                                        
 64  A  8003  8600                   LDAA  #$00    * CONFIG TODO EL PUERTO  A COMO ENTRADAS
 65  A  8005  B71001                 STAA  DDRA    * EL PUERTO A
 66  A                                
 67  A  8008  86FF                   LDAA  #$FF    * CONFIG TODO EL PUERTO  G COMO SALIDAS
 68  A  800A  B71003                 STAA  DDRG    * EL PUERTO G 
 69  A                         
 70  A  800D  8600                   LDAA  #$00    * SE PONE PUERTO G EN CEROS
 71  A  800F  B71002                 STAA  PORTG
 72  A                                
 73  A  8012  CC302C                 LDD   #$302C  * CONFIGURA PUERTO SERIAL
 74  A  8015  B7102B                 STAA  BAUD    * BAUD  9600  para cristal de 8MHz
 75  A  8018  F7102D                 STAB  SCCR2   * HABILITA  RX Y TX PERO INTERRUPCN SOLO RX
 76  A  801B  8600                   LDAA  #$00
 77  A  801D  B7102C                 STAA  SCCR1   * 8 BITS
 78  A                         
 79  A  8020  86FE                   LDAA  #$FE    * CONFIG PUERTO D COMO SALIDAS (EXCEPTO PD0)
 80  A  8022  B71009                 STAA  DDRD    * SEA  ENABLE DEL DISPLAY  PD4  Y RS PD3
 81  A                                              
 82  A                               
 83  A  8025  8604                   LDAA  #$04
 84  A  8027  B7103C                 STAA  HPRIO
 85  A                         
 86  A  802A  8600                   LDAA  #$00
 87  A  802C  06                     TAP
 88  A                         
 89  A                         
 90  A                         
 91  A                                
 92  A                         
 93  A                         
 94  A                         
 95  A                         **********************************
 96  A                         *PROGRAMA PRINCIPAL
 97  A                         **********************************
 98  A  802D                  MAIN  
 99  A  802D  BD80C6                  JSR    INICIA
100  A                                 
101  A  8030  7F0011          INICIO  CLR    U4
102  A  8033  7F0010          NO_S1   CLR    U3
103  A  8036  7F000F          NO_S    CLR    U2
104  A  8039  7F000E                  CLR    U1 
105  A                         
106  A                          
107  A                         
108  A                         
109  A  803C                  OTRO    
110  A  803C  863F                    LDAA    #'?
111  A  803E  970C                    STAA    ORDEN
112  A                                
113  A  8040                  CICLO
114  A  8040  960C                    LDAA    ORDEN
115  A  8042  813F                    CMPA    #'?
116  A  8044  27F2                    BEQ     CICLO
117  A                         
118  A  8046  D60E                    LDAB    U1
119  A  8048  2609                    BNE     CHECA_U2
120  A  804A  8173                    CMPA    #'s
121  A  804C  26FE                    BNE     OTRO
122  A  804E  970E                    STAA    U1
123  A  8050  7E803C                  JMP     OTRO
124  A                         
125  A                         
126  A  8053                  CHECA_U2
127  A                         
128  A  8053  D60F                    LDAB    U2
129  A  8055  2613                    BNE     CHECA_U3
130  A  8057  8154                    CMPA    #'T
131  A  8059  270A                    BEQ     ES_T
132  A  805B  8153                    CMPA    #'S
133  A  805D  2721                    BEQ     OTRO
134  A  805F  7F000E                  CLR     U1
135  A  8062  7E803C                  JMP     OTRO
136  A  8065  970F            ES_T    STAA    U2
137  A  8067  7E803C                  JMP     OTRO
138  A                         
139  A  806A                  CHECA_U3
140  A                         
141  A  806A  D610                    LDAB    U3
142  A  806C  2613                    BNE     CHECA_U4
143  A  806E  8141                    CMPA    #'A
144  A  8070  270A                    BEQ     ES_A
145  A  8072  8153                    CMPA    #'S
146  A  8074  2640                    BNE     NO_S
147  A  8076  7F000F                  CLR     U2
148  A  8079  7E803C                  JMP     OTRO
149  A                         
150  A  807C                  ES_A
151  A                         
152  A  807C  9710                    STAA    U3
153  A  807E  7E803C                  JMP     OTRO
154  A                         
155  A  8081                  CHECA_U4
156  A                         
157  A  8081  D611                    LDAB    U4
158  A  8083  2616                    BNE     CHECA_T
159  A  8085  8152                    CMPA    #'R
160  A  8087  270D                    BEQ     ES_R
161  A  8089  8153                    CMPA    #'S
162  A  808B  2636                    BNE     NO_S1
163  A  808D  7F0010                  CLR     U3
164  A  8090  7F000F                  CLR     U2
165  A  8093  7E803C                  JMP     OTRO
166  A                         
167  A  8096                  ES_R
168  A                         
169  A  8096  9711                    STAA    U4
170  A  8098  7E803C                  JMP     OTRO
171  A                          
172  A  809B                  CHECA_T
173  A                         
174  A  809B  8154                    CMPA    #'T
175  A  809D  2710                    BEQ     EXITO
176  A  809F  8153                    CMPA    #'S
177  A  80A1  2651                    BNE     INICIO
178  A  80A3  7F0011                  CLR     U4
179  A  80A6  7F0010                  CLR     U3
180  A  80A9  7F000F                  CLR     U2
181  A  80AC  7E803C                  JMP     OTRO
182  A                         
183  A  80AF                  EXITO
184  A  80AF  8645                    LDAA  #'E
185  A  80B1  9719                    STAA  ALTO
186  A  80B3  8658                    LDAA  #'X
187  A  80B5  971A                    STAA  BAJO
188  A  80B7  8649                    LDAA  #'I
189  A  80B9  971B                    STAA  BASE_H
190  A  80BB  8654                    LDAA  #'T
191  A  80BD  971C                    STAA  BASE_L
192  A  80BF  864F                    LDAA  #'O
193  A  80C1  971D                    STAA  V3
194  A                         
195  A  80C3  7E802D                  JMP MAIN       
196  A                         
197  A                         
198  A                         ***********************************
199  A                         * INICIA
200  A                         ***********************************
201  A  80C6                  INICIA
202  A                              
203  A  80C6  7F000D                CLR  SEG
204  A                         
205  A  80C9  7F1002                CLR  PORTG
206  A  80CC  86F4                  LDAA #$F4         
207  A  80CE  9718                  STAA TEMPO         * TEMPO ES VARIABLE PARA CONTAR 244 CICLOS
208  A                         
209  A  80D0  CE1024                LDX #TMSK2
210  A  80D3  1C0040                BSET $00,X,#$40    * HABILITA INTERRUPCION TIMER T-REAL
211  A  80D6  0E                    CLI
212  A                         
213  A  80D7  CE1026                LDX #PACTL
214  A  80DA  1C0050                BSET $00,X,#$50    * HABILITA PAEN -ACUMULADOR PULSOS ALTOS-
215  A  80DD  7F1027                CLR PACNT          * BORRA ACUMULADOR DE PULSOS
216  A                         
217  A  80E0  8610                  LDAA #$10
218  A  80E2  971B                  STAA BASE_H        * PONE UN #1060 COMO DIRECCION BASE INICIAL
219  A  80E4  8660                  LDAA #$60
220  A  80E6  971C                  STAA BASE_L    
221  A                               
222  A  80E8  18CE1060              LDY  #$1060      
223  A                               
224  A  80EC  8616                  LDAA #$16
225  A  80EE  9715                  STAA BAS_H        * PONE UN #1653 NUMERO TOTAL DE JUEGO DE MUESTRAS
226  A  80F0  8653                  LDAA #$53
227  A  80F2  9716                  STAA BAS_L   
228  A                         
229  A                         
230  A  80F4  7F0019                CLR  ALTO          * INICIA INDICE MUESTRA EN 0
231  A  80F7  7F001A                CLR  BAJO
232  A                         
233  A  80FA  39                     RTS
234  A                         ***********************************
235  A                         * SACA
236  A                         ***********************************
237  A  80FB                  SACA
238  A                                     
239  A                                
240  A  80FB  9619                   LDAA  ALTO         * INDICE DE MUESTRA (SEGUNDO)
241  A  80FD  D61A                   LDAB  BAJO
242  A  80FF  188F                   XGDY
243  A  8101  1808                   INY
244  A  8103  188F                   XGDY
245  A  8105  BD8241                 JSR   BINBCD
246  A  8108  BD8176                 JSR   DISPLAY
247  A  810B  BD8166                 JSR   COMA
248  A                          
249  A  810E  961B                   LDAA  BASE_H       * INDICE DE MUESTRA (PARTICULAR)
250  A  8110  D61C                   LDAB  BASE_L
251  A  8112  188F                   XGDY
252  A                                
253  A  8114  1808                   INY
254  A  8116  4F                     CLRA
255  A  8117  18E600                 LDAB  $00,Y  
256  A  811A  BD8251                 JSR   BNBCD
257  A  811D  BD8195                 JSR   DSPLY
258  A  8120  BD8166                 JSR   COMA
259  A                         
260  A  8123  1808                   INY
261  A  8125  4F                     CLRA
262  A  8126  18E600                 LDAB  $00,Y
263  A  8129  BD8251                 JSR   BNBCD
264  A  812C  BD8195                 JSR   DSPLY
265  A  812F  BD8166                 JSR   COMA
266  A                         
267  A  8132  1808                   INY
268  A  8134  4F                     CLRA
269  A  8135  18E600                 LDAB  $00,Y
270  A  8138  BD8251                 JSR   BNBCD
271  A  813B  BD8195                 JSR   DSPLY
272  A  813E  BD8166                 JSR   COMA
273  A                         
274  A  8141  1808                   INY
275  A  8143  4F                     CLRA
276  A  8144  18E600                 LDAB  $00,Y
277  A  8147  BD8251                 JSR   BNBCD
278  A  814A  BD8195                 JSR   DSPLY
279  A  814D  BD8166                 JSR   COMA
280  A                          
281  A  8150  1808                   INY
282  A  8152  4F                     CLRA 
283  A  8153  18E600                 LDAB  $00,Y
284  A  8156  BD8251                 JSR   BNBCD
285  A  8159  BD8195                 JSR   DSPLY
286  A                                
287  A  815C  188F                   XGDY
288  A  815E  971B                   STAA BASE_H
289  A  8160  D71C                   STAB BASE_L
290  A                         
291  A  8162  BD81C3                 JSR   CRYTRN
292  A                         
293  A  8165  39                     RTS
294  A                         ***********************************
295  A                         * COMA
296  A                         ***********************************
297  A  8166                  COMA
298  A  8166  CE102E                 LDX   #SCSR 
299  A                                
300  A  8169  B6102E                 LDAA  SCSR
301  A  816C  862C                   LDAA  #$2C             * COMA
302  A  816E  B7102F                 STAA  SCDR
303  A  8171                  C1
304  A  8171  1F0080F4               BRCLR $00,X,#$80 C1 
305  A  8175  39                     RTS
306  A                         ***********************************
307  A                         * DESPLIEGA
308  A                         ***********************************
309  A  8176                  DISPLAY
310  A                                
311  A  8176  CE102E                 LDX   #SCSR 
312  A                                
313  A  8179  B6102E                 LDAA  SCSR
314  A  817C  960E                   LDAA  U1             * U1
315  A  817E  8B30                   ADDA  #$30
316  A  8180  B7102F                 STAA  SCDR
317  A  8183                  T1
318  A  8183  1F0080F4               BRCLR $00,X,#$80 T1 
319  A                               
320  A  8187  B6102E                 LDAA  SCSR
321  A  818A  960F                   LDAA  U2             * U2
322  A  818C  8B30                   ADDA  #$30
323  A  818E  B7102F                 STAA  SCDR
324  A  8191                  T2
325  A  8191  1F0080F4               BRCLR $00,X,#$80 T2 
326  A                         
327  A  8195                  DSPLY  
328  A  8195  CE102E                 LDX   #SCSR
329  A                             
330  A  8198  B6102E                 LDAA SCSR
331  A  819B  9610                   LDAA  U3             * U3
332  A  819D  8B30                   ADDA  #$30
333  A  819F  B7102F                 STAA  SCDR
334  A  81A2                  T3
335  A  81A2  1F0080F4               BRCLR $00,X,#$80 T3 
336  A                               
337  A  81A6  B6102E                 LDAA SCSR 
338  A  81A9  9611                   LDAA  U4             * U4
339  A  81AB  8B30                   ADDA  #$30
340  A  81AD  B7102F                 STAA  SCDR
341  A  81B0                  T4
342  A  81B0  1F0080F4               BRCLR $00,X,#$80 T4 
343  A                            
344  A  81B4  B6102E                 LDAA SCSR
345  A  81B7  9612                   LDAA  U5             * U5
346  A  81B9  8B30                   ADDA  #$30
347  A  81BB  B7102F                 STAA  SCDR
348  A  81BE                  T5
349  A  81BE  1F0080F4               BRCLR $00,X,#$80 T5  
350  A                                
351  A  81C2  39                     RTS
352  A                         
353  A                         ***********************************
354  A                         * CARRY RETURN
355  A                         ***********************************
356  A                         
357  A  81C3                  CRYTRN
358  A  81C3  CE102E                 LDX   #SCSR 
359  A  81C6  B6102E                 LDAA  SCSR
360  A  81C9  860A                   LDAA  #$0A             * NEW LINE     
361  A  81CB  B7102F                 STAA  SCDR
362  A  81CE                  CR1
363  A  81CE  1F0080F4               BRCLR $00,X,#$80 CR1        
364  A                         
365  A  81D2  B6102E                 LDAA SCSR
366  A  81D5  860D                   LDAA #$0D              * CARRY RETURN     
367  A  81D7  B7102F                 STAA SCDR
368  A  81DA                  CR2
369  A  81DA  1F0080F4               BRCLR $00,X,#$80 CR2        
370  A                         
371  A  81DE  39                     RTS
372  A                         ***********************************
373  A                         *  DESPLIEGUE DE DATO RECIBIDO
374  A                         ***********************************
375  A                         
376  A  81DF                  DATARX
377  A  81DF  CE102E                 LDX   #SCSR 
378  A  81E2  B6102E                 LDAA  SCSR
379  A  81E5  960C                   LDAA  ORDEN             * NEW LINE     
380  A  81E7  B7102F                 STAA  SCDR
381  A  81EA                  DT1
382  A  81EA  1F0080F4               BRCLR $00,X,#$80 DT1        
383  A                         
384  A  81EE  B6102E                 LDAA SCSR 
385  A  81F1  863A                   LDAA #$3A              * DOS PUNTOS    
386  A  81F3  B7102F                 STAA SCDR
387  A  81F6                  DT2
388  A  81F6  1F0080F4               BRCLR $00,X,#$80 DT2        
389  A                         
390  A  81FA  39                     RTS
391  A                         ***********************************
392  A                         * voltimetro
393  A                         ***********************************
394  A  81FB                  VOLTA
395  A  81FB  CE1030                LDX #ADCTL      
396  A                         
397  A  81FE  8680                  LDAA #$80
398  A  8200  B71039                STAA OPTION        * PONE EN MARCHA EL ADC
399  A                             
400  A  8203  8610                  LDAA #$10
401  A  8205  B71030                STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 0
402  A                         
403  A  8208                  E1
404  A  8208  1F0080F4              BRCLR $00,X,#$80 E1  
405  A  820C  F61031                LDAB ADR1
406  A  820F  D713                  STAB V1
407  A                               
408  A  8211  8680                  LDAA #$80
409  A  8213  B71039                STAA OPTION        * PONE EN MARCHA EL ADC
410  A                             
411  A  8216  8611                  LDAA #$11
412  A  8218  B71030                STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 1
413  A                         
414  A  821B                  E2
415  A  821B  1F0080F4              BRCLR $00,X,#$80 E2  
416  A  821F  F61032                LDAB ADR2
417  A  8222  D714                  STAB V2
418  A                              
419  A  8224  8612                  LDAA #$12
420  A  8226  B71030                STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 2
421  A                         
422  A  8229                  E3
423  A  8229  1F0080F4              BRCLR $00,X,#$80 E3  
424  A  822D  F61033                LDAB ADR3
425  A  8230  D71D                  STAB V3 
426  A                         
427  A  8232  8613                  LDAA #$13
428  A  8234  B71030                STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 3
429  A                         
430  A  8237                  E4
431  A  8237  1F0080F4              BRCLR $00,X,#$80 E4  
432  A  823B  F61034                LDAB ADR4
433  A  823E  D71E                  STAB V4
434  A                         
435  A                                    
436  A  8240  39                    RTS
437  A                         ***********************************
438  A                         * CONVIERTE A BCD
439  A                         ***********************************
440  A                         
441  A  8241                  BINBCD
442  A                              
443  A  8241  CE2710                LDX  #$2710
444  A  8244  02                    IDIV 
445  A  8245  8F                    XGDX
446  A  8246  D70E                  STAB U1
447  A  8248  8F                    XGDX
448  A  8249  CE03E8                LDX  #$3E8
449  A  824C  02                    IDIV
450  A  824D  8F                    XGDX
451  A  824E  D70F                  STAB U2
452  A  8250  8F                    XGDX
453  A                         
454  A  8251                  BNBCD
455  A  8251  CE0064                LDX  #$64
456  A  8254  02                    IDIV
457  A  8255  8F                    XGDX
458  A  8256  D710                  STAB U3
459  A  8258  8F                    XGDX
460  A  8259  CE000A                LDX  #$A
461  A  825C  02                    IDIV
462  A  825D  8F                    XGDX
463  A  825E  D711                  STAB U4
464  A  8260  8F                    XGDX
465  A  8261  D712                  STAB U5
466  A                         
467  A                         
468  A                         
469  A  8263  39                    RTS
470  A                         
471  A                         
472  A                         
473  A                         ***********************************
474  A                         * ATENCION A INTERRUPCION SERIAL
475  A                         ***********************************
476  A  F100                         ORG  $F100
477  A                           
478  A  F100  36                     PSHA
479  A                          
480  A  F101  B6102E                 LDAA SCSR
481  A  F104  B6102F                 LDAA SCDR
482  A  F107  970C                   STAA ORDEN
483  A                         
484  A  F109  32                     PULA  
485  A                         
486  A  F10A  3B                     RTI
487  A                         
488  A                         ***********************************
489  A                         * ATENCION A INTERRUPCION REAL TIME
490  A                         ***********************************
491  A  F110                        ORG  $F110
492  A                         
493  A  F110  36                    PSHA
494  A  F111  3C                    PSHX
495  A                         
496  A  F112  CE1025                LDX #TFLG2
497  A  F115  1C0040                BSET $00,X,#$40    * BORRA BANDERA INTERRUPCION
498  A  F118  7A0018                DEC TEMPO
499  A  F11B  2703                  BEQ SEGUNDO
500  A                               
501  A  F11D  32                    PULA
502  A  F11E  38                    PULX
503  A  F11F  3B                    RTI
504  A                         
505  A  F120                  SEGUNDO
506  A  F120  86FF                  LDAA #$FF
507  A  F122  970D                  STAA SEG           * SEG ES UNA BANDERA DE SEGUNDO    
508  A  F124  86F4                  LDAA #$F4         
509  A  F126  9718                  STAA TEMPO         * TEMPO ES VARIABLE PARA CONTAR 244 CICLOS
510  A  F128  7C1002                INC  PORTG
511  A                              
512  A  F12B  32                    PULA
513  A  F12C  38                    PULX
514  A  F12D  3B                    RTI
515  A                         ***********************************
516  A                         * VECTOR INTERRUPCION SERIAL
517  A                         ***********************************
518  A  FFD6                         ORG   $FFD6
519  A  FFD6                         FCB   $F1,$00       
520  A                         
521  A                         ***********************************
522  A                         * VECTOR INTERRUPCION REAL TIME
523  A                         ***********************************
524  A  FFFE                         ORG   $FFFE
525  A  FFFE                         FCB   $F1,$10       
526  A                         
527  A                         ***********************************
528  A                         *RESET
529  A                         ***********************************
530  A  FFFE                         END       $8000       
531  A                         
